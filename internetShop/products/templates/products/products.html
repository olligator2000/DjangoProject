{% extends 'products/base.html' %}

{% load static %}

{% block css %}
<link rel="stylesheet" href="/static/css/products.css">
<link rel="stylesheet" href="/static/css/index.css">
{% endblock %}

{% block content %}
<nav class="custom-breadcrumb">
    <a href="{% url 'products:index' %}" class="custom-breadcrumb-link">Каталог товаров</a> →
    <span class="custom-breadcrumb-current">{{ category.name }}</span>
</nav>

<div class="products-page-container">
    <!-- Фильтры слева -->
    <aside class="filters-sidebar">
        <div class="filter-section">
            <h3>Бренд</h3>
            <ul class="filter-list">
                {% for brand in brands %}
                <li>
                    <label>
                        <input type="checkbox" name="brand" value="{{ brand }}">
                        {{ brand }}
                    </label>
                </li>
                {% endfor %}
            </ul>
        </div>

        <div class="filter-section">
            <h3>Производитель</h3>
            <ul class="filter-list">
                {% for manufacturer in manufacturers %}
                <li>
                    <label>
                        <input type="checkbox" name="manufacturer" value="{{ manufacturer }}">
                        {{ manufacturer }}
                    </label>
                </li>
                {% endfor %}
            </ul>
        </div>

        <div class="filter-section">
            <h3>Цена</h3>
            <div class="price-range">
                <input type="range" id="price-slider" min="0" max="10000" step="100" value="10000">
                <div class="price-values">
                    <span id="min-price">0 ₽</span>
                    <span id="max-price">10000 ₽</span>
                </div>
            </div>
        </div>

        <button class="apply-filters-btn">Применить фильтры</button>
    </aside>

    <!-- Основной контент -->
    <main class="products-content">
        <div class="sorting-options">
            <span>Сортировать:</span>
            <select id="sort-select">
                <option value="price_asc">По цене (дешевле)</option>
                <option value="price_desc">По цене (дороже)</option>
                <option value="rating">По рейтингу</option>
                <option value="popularity">По популярности</option>
            </select>
        </div>

        <div class="shop-container">
            <div class="products-grid">
                {% for product in products %}
                <div class="product-card">
                    <img class="product-image" src="/media/{{ product.image }}" alt="{{ product.name }}">
                    <h3 class="product-title">{{ product.name }}</h3>
                    <div class="product-price">{{ product.price|stringformat:"d" }} ₽</div>
                    <p class="product-description">{{ product.short_description }}</p>
                    <button class="add-to-cart-btn" data-product-id="{{ product.id }}">Добавить в корзину</button>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>
</div>

<!-- Подключаем корзину -->
<div id="cart-container">
    {% include 'products/basket.html' %}
</div>

{% endblock %}

{% block footer %}
<!--pass-->
{% endblock %}

{% block scripts %}
<script>
// Обработка фильтров
document.addEventListener('DOMContentLoaded', function() {
    const priceSlider = document.getElementById('price-slider');
    const maxPriceDisplay = document.getElementById('max-price');

    priceSlider.addEventListener('input', function() {
        maxPriceDisplay.textContent = this.value + ' ₽';
    });

    document.querySelector('.apply-filters-btn').addEventListener('click', function() {
        const selectedBrands = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map(el => el.value);
        const selectedManufacturers = Array.from(document.querySelectorAll('input[name="manufacturer"]:checked')).map(el => el.value);
        const maxPrice = priceSlider.value;
        const sortOption = document.getElementById('sort-select').value;

        // Здесь можно добавить AJAX-запрос для фильтрации товаров
        // или перезагрузить страницу с параметрами фильтрации
        const params = new URLSearchParams();
        if (selectedBrands.length) params.append('brands', selectedBrands.join(','));
        if (selectedManufacturers.length) params.append('manufacturers', selectedManufacturers.join(','));
        params.append('max_price', maxPrice);
        params.append('sort', sortOption);

        window.location.href = window.location.pathname + '?' + params.toString();
    });

    // Инициализация корзины
    initCart();
});
</script>
{% endblock %}